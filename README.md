# mahjong16-go

以 Go 語言實作的**十六張麻將**模擬器，包含四人自動對局與簡易 AI 決策邏輯。

## 功能

- 完整牌組（144 張）：餅（筒）、索（條）、萬、風牌（東南西北）、三元牌（中發白）、花牌（春夏秋冬梅蘭竹菊）
- 四人自動對局，輪流摸牌、打牌
- 自動補花（摸到花牌後補抽一張）
- 聽牌計算：列出打出每張牌後可等待的胡牌
- 胡牌判定：支援標準麻將胡牌型（眼＋順子／刻子）
- 簡易 AI：優先打出能讓聽牌數最多的牌

## 執行方式

需先安裝 [Go](https://go.dev/)（1.18 以上版本）。

```bash
go run mahjong.go
```

## 程式架構

### 型別

| 型別 | 說明 |
|------|------|
| `Mahjong` | 遊戲狀態：手牌張數、四位玩家、剩餘牌堆、海底 |
| `Player` | 玩家狀態：手牌、桌面牌（花）、已見牌統計、打牌機率、聽牌清單 |

### 牌號編碼

牌號為 0～151 的整數，每種牌面有 4 張（index `n`，牌面 `n/4`）：

| 範圍 | 牌種 |
|------|------|
| 0 – 35 | 1～9 筒（餅） |
| 36 – 71 | 1～9 條（索） |
| 72 – 107 | 1～9 萬 |
| 108 – 123 | 東南西北（風牌） |
| 124 – 135 | 中發白（三元牌） |
| 136 – 143 | 春夏秋冬梅蘭竹菊（花牌） |

### 主要函式

| 函式 | 說明 |
|------|------|
| `nToChinese(n)` | 將牌號轉為中文名稱（如 `"3筒"`、`"東"`） |
| `initDeal()` | 洗牌並發初始手牌（每人 16 張） |
| `showBonus()` | 開局補花，並初始化各玩家的已見牌記錄 |
| `iShowBonus(p, i)` | 對第 `i` 張手牌遞迴補花 |
| `initSee(p)` / `addSee(t)` | 更新玩家已見過的牌（不含手牌） |
| `gates(p)` | 計算打出每張牌後的聽牌清單（`map[牌面]聽牌數`） |
| `decidePlay(p)` | AI 決策：優先打後聽牌最多，次選最常出現的牌 |
| `play(n, hand)` | 將手牌第 `n` 張與第 `hand` 張（剛摸到的牌）交換，實現打牌 |
| `isWin(p)` | 判斷玩家是否胡牌 |
| `isSuit(suited)` | 判斷數牌部分是否合法（遞迴，採定理一） |
| `isHonor(honor)` | 判斷字牌部分是否合法（每種字牌須為 0 或 3 張） |
| `findPair(s, pairs)` | 找出手牌中所有可能的「眼」位置（採定理二） |

### 胡牌判定演算法

胡牌判定依據兩條數學定理（參考：[關鍵評論網](https://www.thenewslens.com/article/100657)）：

- **定理一（`isSuit`）**：數牌遞迴消除刻子與順子，若最終消光則合法。
- **定理二（`findPair`）**：利用每花色牌數模 3 的餘數，快速定位眼所在的「桶」（餘數為 0、1、2 的組別），減少枚舉量。

`isWin` 的流程：
1. 排序手牌
2. 以定理二找出所有候選眼位
3. 對每個眼，暫時移除 2 張，再分別用 `isHonor` 和 `isSuit` 驗證剩餘牌是否合法

### AI 決策邏輯（`decidePlay`）

1. 從 `gates` 結果中找出打後聽牌數最多的牌，優先打出。
2. 若無聽牌，打出出現次數（`cPlay`）最少（即最稀有）的牌。
3. 若仍無法決定，隨機選牌。

## 輸出格式範例

```
0 1筒 3筒 ...（開局手牌及補花）

0摸 5條 打後聽牌: 2萬=3 東=1
0打 5條_ 1筒 3筒 5筒 ...
1摸 中 ...
...
2胡 1筒 3筒 5筒 ...
```

- `補 X`：補花後摸到的牌
- `打後聽牌: 牌=數`：打出某牌後，有幾張可胡的牌在牌堆中
- `X打 Y_`：X 玩家打出 Y 牌，`_` 後為剩餘手牌
- `|X`：桌面花牌

## 限制與注意事項

- 本程式為純自動對局（無使用者互動）
- 不支援吃、碰、槓
- 不計算番數或積分
- 每次執行結果隨機（使用 `math/rand` 預設亂數種子）
